<form class="{{cssClass}} flexcol" autocomplete="off">
{{> (get . "sheet.parts.header")}}

  <nav class="tabs flex-fixed" data-group="primary">
    <a class="item" data-tab="stats">{{localize "wv.system.misc.statistics"}}</a>
    <a class="item" data-tab="sources">{{localize "wv.system.misc.sourceValues"}}</a>
    <a class="item" data-tab="rules">{{localize "wv.system.ruleEngine.ruleElement.plural"}}</a>
  </nav>

  <section class="content">
    <div class="tab active" data-group="primary" data-tab="stats">
      <table>
        <thead>
          <tr>
            <th scope="col" class="align-left">{{localize "wv.system.misc.name"}}</th>
            <th scope="col" class="align-right">{{localize "wv.rules.damage.long"}}</th>
            <th scope="col" class="align-right">{{localize "wv.rules.damage.threshold.reduction.long"}}</th>
            <th scope="col" class="align-right">{{localize "wv.rules.actionPoints.use"}}</th>
            <th scope="col" class="align-right">{{localize "wv.rules.equipment.weapon.shots"}}</th>
          </tr>
        </thead>
        <tbody>
          {{~#each data.data.attacks.attacks as |attack|~}}
            <tr>
              <th scope="row" class="align-left">
                <button class="min-width no-wrap" type="button" title="{{localize 'wv.system.rolls.modifierExplanation'}}" data-weapon-attack-name="{{@key}}">{{@key}}</button>
              </th>
              <td class="align-right">{{attack.damageFormula}} = {{attack.damageRange}}</td>
              <td class="align-right">{{attack.data.dtReduction.total}}</td>
              <td class="align-right">{{attack.data.ap.total}}</td>
              <td class="align-right">{{attack.data.rounds.total}}</td>
            </tr>
          {{~/each~}}
        </tbody>
      </table>
      <div class="detail-groups">
        <section>
          <span>{{localize "wv.rules.range.plural"}}:</span>
          <span class="details">
            <span>{{localize "wv.rules.range.ranges.short.long"}} ({{sheet.displayRanges.short}}{{sheet.systemGridUnit}}) [{{data.data.ranges.short.modifier.total}}]</span>
            {{~#unless (eq "-" sheet.displayRanges.medium)~}}
              <span>{{localize "wv.rules.range.ranges.medium.long"}} ({{sheet.displayRanges.medium}}{{sheet.systemGridUnit}}) [{{data.data.ranges.medium.modifier.total}}]</span>
            {{~/unless~}}
            {{~#unless (eq "-" sheet.displayRanges.long)~}}
              <span>{{localize "wv.rules.range.ranges.long.long"}} ({{sheet.displayRanges.long}}{{sheet.systemGridUnit}}) [{{data.data.ranges.long.modifier.total}}]</span>
            {{~/unless~}}
          </span>
        </section>
        {{~#if (gt data.data.reload.size.total 0)~}}
          <section>
            <span>{{localize "wv.rules.equipment.weapon.reload.name"}}:</span>
            <span class="details">
              <span>{{localize "wv.rules.actionPoints.use"}}: {{data.data.reload.ap.total}}</span
              ><span>{{data.data.reload.size.total}} * {{sheet.reload.caliber}}</span
              ><span>{{sheet.reload.containerType}}</span>
            </span>
          </section>
        {{~/if~}}
        <section class="details">
          <span>{{localize "wv.rules.skills.singular"}}: {{sheet.skill}}</span
          ><span>{{localize "wv.rules.equipment.weapon.strengthRequirement.long"}}: {{data.data.strengthRequirement.total}}</span>
          {{~#if data.data.holdout~}}
            <span>{{localize "wv.rules.equipment.weapon.holdout"}}</span>
          {{~/if~}}
        </section>
        {{~#if data.data.notes~}}
          <section>{{data.data.notes}}</section>
        {{~/if~}}
      </div>
    </div>

    <div class="tab" data-group="primary" data-tab="sources">
{{> (get . "sheet.parts.physicalItemInputs")}}
      <div class="flexrow flex-j-spaced spacing-bottom">
        <label class="contained-target-inline flex-fixed">
          {{~localize "wv.rules.skills.singular"~}}
          <select name="data.skill">
            {{~selectOptions sheet.skills selected=data.data.skill~}}
          </select>
        </label>
        <label class="contained-target-inline flex-fixed">
          {{~localize "wv.rules.equipment.weapon.strengthRequirement.long"~}}
          <input class="size-2" type="number" name="data.strengthRequirement.source" value="{{data.data.strengthRequirement.source}}" min="0" max="15" />
        </label>
        <label class="contained-target-inline flex-fixed flex-center">
          {{~localize "wv.rules.equipment.weapon.holdout"~}}
          <input type="checkbox" name="data.holdout" {{checked data.data.holdout}} />
        </label>
      </div>
      <div class="flexrow flex-j-spaced align-baseline spacing-bottom">
        <span class="flex-fixed">{{localize "wv.rules.equipment.weapon.reload.name"}}:</span>
        <label class="contained-target-inline flex-fixed" title="{{localize 'wv.rules.actionPoints.use'}}">
          {{~localize "wv.rules.actionPoints.use"~}}
          <input type="number" class="size-2" name="data.reload.ap.source" value="{{data.data.reload.ap.source}}" min="0" />
        </label>
        <span class="flex-fixed no-wrap">
          <input type="number" class="size-3" name="data.reload.size.source" value="{{data.data.reload.size.source}}" min="0" title="{{localize 'wv.rules.equipment.weapon.reload.containerSize'}}" />
          <span> * </span>
          <select name="data.reload.caliber" title="{{localize 'wv.rules.equipment.ammo.caliber'}}">
            {{~selectOptions sheet.reload.calibers selected=data.data.reload.caliber~}}
          </select>
        </span>
        <select class="flex-fixed" name="data.reload.containerType" title="{{localize 'wv.rules.equipment.weapon.reload.containerType'}}">
          {{~selectOptions sheet.reload.containerTypes selected=data.data.reload.containerType~}}
        </select>
      </div>
      <table class="spacing-bottom">
        <thead>
          <tr>
            <th scope="col" class="align-left">{{localize "wv.rules.range.singular"}}</th>
            <th scope="col" class="align-right">{{localize "wv.rules.range.distance.name"}}</th>
            <th scope="col" class="align-right">{{localize "wv.system.misc.modifier"}}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row" class="align-left">{{localize "wv.rules.range.ranges.short.long"}}</th>
            <td class="align-right">
              <input type="number" class="size-3" name="data.ranges.short.distance.base.source" value="{{data.data.ranges.short.distance.base.source}}" min="0" />
              <span>+</span>
              <input type="number" class="size-2" name="data.ranges.short.distance.multiplier.source" value="{{data.data.ranges.short.distance.multiplier.source}}" min="0" />
              <span>*</span>
              <select name="data.ranges.short.distance.special">
                {{~selectOptions sheet.specials selected=data.data.ranges.short.distance.special~}}
              </select>
            </td>
            <td class="align-right min-width">
              <input type="number" class="size-3" name="data.ranges.short.modifier.source" value="{{data.data.ranges.short.modifier.source}}" />
            </td>
          </tr>
          <tr>
            <th scope="row" class="align-left">{{localize "wv.rules.range.ranges.medium.long"}}</th>
            <td class="align-right">
              <input type="number" class="size-3" name="data.ranges.medium.distance.base.source" value="{{data.data.ranges.medium.distance.base.source}}" min="0" />
              <span>+</span>
              <input type="number" class="size-2" name="data.ranges.medium.distance.multiplier.source" value="{{data.data.ranges.medium.distance.multiplier.source}}" min="0" />
              <span>*</span>
              <select name="data.ranges.medium.distance.special">
                {{~selectOptions sheet.specials selected=data.data.ranges.medium.distance.special~}}
              </select>
            </td>
            <td class="align-right min-width">
              <input type="number" class="size-3" name="data.ranges.medium.modifier.source" value="{{data.data.ranges.medium.modifier.source}}" />
            </td>
          </tr>
          <tr>
            <th scope="row" class="align-left">{{localize "wv.rules.range.ranges.long.long"}}</th>
            <td class="align-right">
              <input type="number" class="size-3" name="data.ranges.long.distance.base.source" value="{{data.data.ranges.long.distance.base.source}}" min="0" />
              <span>+</span>
              <input type="number" class="size-2" name="data.ranges.long.distance.multiplier.source" value="{{data.data.ranges.long.distance.multiplier.source}}" min="0" />
              <span>*</span>
              <select name="data.ranges.long.distance.special">
                {{~selectOptions sheet.specials selected=data.data.ranges.long.distance.special~}}
              </select>
            </td>
            <td class="align-right min-width">
              <input type="number" class="size-3" name="data.ranges.long.modifier.source" value="{{data.data.ranges.long.modifier.source}}" />
            </td>
          </tr>
        </tbody>
      </table>
      <table>
        <thead>
          <tr>
            <th scope="col" class="align-left">{{localize "wv.system.misc.name"}}</th>
            <th scope="col" class="align-left">{{localize "wv.rules.damage.long"}}</th>
            <th scope="col" class="align-right min-width">{{localize "wv.rules.damage.threshold.reduction.short"}}</th>
            <th scope="col" class="align-right min-width">{{localize "wv.rules.equipment.weapon.shots"}}</th>
            <th scope="col" class="align-right min-width">{{localize "wv.rules.actionPoints.use"}}</th>
            <th scope="col" class="align-right min-width">
              <button type="button" class="control medium weapon-attack-control fas fa-plus parchment-bg" data-action="create" title="{{localize 'wv.system.actions.create'}}"></button>
            </th>
          </tr>
        </thead>
        <tbody>
          {{~#each data.data.attacks.attacks as |attack|~}}
            <tr class="weapon-attack">
              <th scope="row" class="align-left">
                <input type="text" name="sheet.attacks.name.{{@key}}" value="{{@key}}" />
              </th>
              <td class="align-left">
                <input type="number" class="size-2" name="data.attacks.sources.{{@key}}.damage.base.source" value="{{attack.data.damage.base.source}}" min="0" title="{{localize 'wv.rules.damage.baseDamage'}}" />
                <span>+</span>
                <input type="number" class="size-2" name="data.attacks.sources.{{@key}}.damage.dice.source" value="{{attack.data.damage.dice.source}}" min="0" title="{{localize 'wv.rules.damage.damageDice'}}" />
                <span>d6</span>
                <input type="checkbox" name="data.attacks.sources.{{@key}}.damage.diceRange" {{checked attack.data.damage.diceRange}} title="{{localize 'wv.rules.damage.diceRange'}}" />
                <select name="data.attacks.sources.{{@key}}.damage.damageFallOff" title="{{localize 'wv.rules.damage.fallOff.name'}}">
                  {{~selectOptions ../sheet.damageFallOffTypes selected=attack.data.damage.damageFallOff~}}
                </select>
              </td>
              <td class="align-right min-width">
                <input type="number" class="size-2" name="data.attacks.sources.{{@key}}.dtReduction.source" value="{{attack.data.dtReduction.source}}" min="0" />
              </td>
              <td class="align-right min-width">
                <input type="number" class="size-2" name="data.attacks.sources.{{@key}}.rounds.source" value="{{attack.data.rounds.source}}" min="0" />
              </td>
              <td class="align-right min-width">
                <input type="number" class="size-2" name="data.attacks.sources.{{@key}}.ap.source" value="{{attack.data.ap.source}}" min="0" />
              </td>
              <td class="min-width">
                <button type="button" class="control medium weapon-attack-control fas fa-minus" data-action="delete" data-attack="{{@key}}" title="{{localize 'wv.system.actions.delete'}}"></button>
              </td>
            </tr>
          {{~/each~}}
        </tbody>
      </table>
    </div>

    <div class="tab" data-group="primary" data-tab="rules">
{{> (get . "sheet.parts.rules")}}
    </div>
  </section>
</form>
